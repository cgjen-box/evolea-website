---
import Base from '@layouts/Base.astro';
import FloatingShapes from '@components/FloatingShapes.astro';
import GradientCTA from '@components/GradientCTA.astro';
import Icon from '@components/Icon.astro';
import { getLangFromUrl, useTranslatedPath } from '@i18n/utils';
import { getEntry } from 'astro:content';

const lang = getLangFromUrl(Astro.url);
const translatePath = useTranslatedPath(lang);
const base = import.meta.env.BASE_URL.replace(/\/$/, '');

// Get CMS content
const pageEntry = await getEntry('pages', 'tagesschule');
const page = pageEntry?.data;

// Get site images from CMS
const siteImagesEntry = await getEntry('settings', 'images');
const siteImages = siteImagesEntry?.data;
const heroImage = siteImages?.programmeHeroes?.tagesschule
  ? base + siteImages.programmeHeroes.tagesschule
  : base + "/images/generated/tagesschule-hero.png";

// Helper to get bilingual text
const getText = (obj: { de?: string; en?: string } | undefined, fallback: string = '') => {
  if (!obj) return fallback;
  return lang === 'de' ? (obj.de || fallback) : (obj.en || obj.de || fallback);
};

// Page content with fallbacks
const hero = page?.hero || {};
const statusBanner = page?.statusBanner || { aktiv: true };
const infoKarten = page?.infoKarten || [];
const wasIst = page?.wasIst || {};
const fuerWen = page?.fuerWen || {};
const ansatz = page?.ansatz || {};
const typischerTag = page?.typischerTag || {};
const interesse = page?.interesse || {};
const weitereAngebote = page?.weitereAngebote || {};
const cta = page?.cta || {};
---

<Base title={hero.titel || 'Tagesschule'} description="Strukturiertes Tagesschulprogramm mit individueller Förderung für Kinder im Autismus Spektrum in Zürich.">
  <!-- Hero Section -->
  <section class="relative py-20 md:py-28 bg-gradient-to-br from-evolea-purple/10 to-evolea-cream overflow-hidden">
    <FloatingShapes variant="minimal" />
    <div class="container mx-auto max-w-6xl px-4 relative z-10">
      <nav class="mb-8 text-sm text-evolea-text-light">
        <a href={translatePath('/')} class="hover:text-evolea-purple transition-colors">{lang === 'de' ? 'Startseite' : 'Home'}</a>
        <span class="mx-2">/</span>
        <a href={translatePath('/angebote/')} class="hover:text-evolea-purple transition-colors">{lang === 'de' ? 'Angebote' : 'Programs'}</a>
        <span class="mx-2">/</span>
        <span class="text-evolea-purple font-medium">{hero.titel || 'Tagesschule'}</span>
      </nav>

      <div class="grid lg:grid-cols-2 gap-12 items-center">
        <div>
          <div class="inline-flex items-center gap-2 bg-evolea-purple/20 text-evolea-purple px-4 py-2 rounded-full text-sm font-medium mb-6">
            <Icon name="book" size="sm" />
            <span>{getText(hero.badge, 'Tagesstruktur mit Lernförderung')}</span>
          </div>
          <h1 class="text-4xl md:text-5xl lg:text-6xl font-display font-bold text-evolea-purple mb-6 leading-tight">
            {hero.titel || 'Tagesschule'}
          </h1>
          <p class="text-xl md:text-2xl text-evolea-text-light mb-8 leading-relaxed">
            {getText(hero.untertitel, 'Strukturierte Tagesbetreuung mit individueller Förderung für Kinder im Spektrum')}
          </p>
          <div class="flex flex-wrap gap-4">
            <a href={hero.buttonLink || '#interesse'} class="btn-primary">
              {getText(hero.buttonText, 'Interesse anmelden')}
              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
              </svg>
            </a>
            <a href={hero.zweitButtonLink || translatePath('/kontakt/')} class="btn-secondary">
              {getText(hero.zweitButtonText, 'Fragen? Kontaktieren Sie uns')}
            </a>
          </div>
        </div>
        <div class="relative">
          <img
            src={heroImage}
            alt={getText(hero.untertitel, 'Kinder in strukturierter Lernumgebung')}
            class="rounded-evolea-lg shadow-elevated w-full object-cover aspect-4/3"
          />
          <div class="absolute -bottom-4 -left-4 bg-white rounded-evolea p-4 shadow-card">
            <div class="text-3xl font-display font-bold text-evolea-purple">{hero.alter || '6-12'}</div>
            <div class="text-sm text-evolea-text-light">{lang === 'de' ? 'Jahre' : 'Years'}</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Status Banner -->
  {statusBanner.aktiv && (
    <section class="bg-evolea-purple text-white py-6">
      <div class="container mx-auto max-w-6xl px-4">
        <div class="flex items-center justify-center gap-4">
          <Icon name="sparkle" size="md" />
          <span class="text-lg">{getText(statusBanner.text, 'Dieses Programm befindet sich in der Aufbauphase - Interessensanmeldungen sind willkommen')}</span>
        </div>
      </div>
    </section>
  )}

  <!-- Key Info Cards -->
  <section class="py-16 bg-white">
    <div class="container mx-auto max-w-6xl px-4">
      <div class="grid md:grid-cols-4 gap-6">
        {infoKarten.length > 0 ? (
          infoKarten.map((karte: any) => (
            <div class="bg-evolea-cream rounded-evolea-lg p-6 text-center">
              <Icon name="sparkle" size="lg" />
              <div class="font-display font-bold text-evolea-purple text-lg mt-3">{getText(karte.label, '')}</div>
              <div class="text-evolea-text-light">{getText(karte.wert, '')}</div>
            </div>
          ))
        ) : (
          <>
            <div class="bg-evolea-cream rounded-evolea-lg p-6 text-center">
              <Icon name="sparkle" size="lg" />
              <div class="font-display font-bold text-evolea-purple text-lg mt-3">Alter</div>
              <div class="text-evolea-text-light">6-12 Jahre</div>
            </div>
            <div class="bg-evolea-cream rounded-evolea-lg p-6 text-center">
              <Icon name="people" size="lg" />
              <div class="font-display font-bold text-evolea-purple text-lg mt-3">Betreuung</div>
              <div class="text-evolea-text-light">Kleine Gruppen</div>
            </div>
            <div class="bg-evolea-cream rounded-evolea-lg p-6 text-center">
              <Icon name="clipboard" size="lg" />
              <div class="font-display font-bold text-evolea-purple text-lg mt-3">Zeiten</div>
              <div class="text-evolea-text-light">Ganztags</div>
            </div>
            <div class="bg-evolea-cream rounded-evolea-lg p-6 text-center">
              <Icon name="target" size="lg" />
              <div class="font-display font-bold text-evolea-purple text-lg mt-3">Wo</div>
              <div class="text-evolea-text-light">Zürich</div>
            </div>
          </>
        )}
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <section class="py-16 md:py-24">
    <div class="container mx-auto max-w-4xl px-4">
      <div class="prose prose-lg max-w-none">

        <h2 class="text-3xl font-display font-bold text-evolea-purple mb-6 flex items-center gap-3">
          <span class="text-evolea-green">●</span>
          {getText(wasIst.titel, 'Was ist die EVOLEA Tagesschule?')}
        </h2>
        <p class="text-evolea-text-light mb-8 text-lg leading-relaxed">
          {getText(wasIst.text, 'Die EVOLEA Tagesschule bietet eine strukturierte Tagesbetreuung mit integrierter Lernförderung für Kinder im Autismus Spektrum. In kleinen Gruppen mit hohem Betreuungsschlüssel schaffen wir einen geschützten Rahmen, der individuelles Lernen und soziale Entwicklung ermöglicht.')}
        </p>

        <div class="bg-evolea-purple/5 border-l-4 border-evolea-purple rounded-r-evolea p-6 mb-12">
          <h3 class="font-display font-bold text-evolea-purple text-xl mb-2">{getText(wasIst.konzeptTitel, 'Unser Konzept')}</h3>
          <p class="text-evolea-text-light mb-0">
            {getText(wasIst.konzeptText, 'Evidenzbasierte Methoden + Individuelle Förderpläne + Strukturierter Tagesablauf - Diese Kombination ermöglicht es jedem Kind, in seinem eigenen Tempo zu lernen und seine Stärken zu entfalten.')}
          </p>
        </div>

        <h2 class="text-3xl font-display font-bold text-evolea-purple mb-6 flex items-center gap-3">
          <span class="text-evolea-orange">●</span>
          {getText(fuerWen.titel, 'Für wen ist die Tagesschule?')}
        </h2>
        <p class="text-evolea-text-light mb-6 text-lg leading-relaxed">
          {getText(fuerWen.text, 'Unser Angebot richtet sich an Kinder im Alter von 6-12 Jahren, die:')}
        </p>
        <ul class="space-y-3 mb-12">
          {fuerWen.kriterien?.length > 0 ? (
            fuerWen.kriterien.map((k: any) => (
              <li class="flex items-start gap-3 text-evolea-text-light">
                <span class="text-evolea-green mt-1">●</span>
                <span>{getText(k, '')}</span>
              </li>
            ))
          ) : (
            <>
              <li class="flex items-start gap-3 text-evolea-text-light">
                <span class="text-evolea-green mt-1">●</span>
                <span>Im Autismus Spektrum diagnostiziert sind oder eine ADHS-Diagnose haben</span>
              </li>
              <li class="flex items-start gap-3 text-evolea-text-light">
                <span class="text-evolea-green mt-1">●</span>
                <span>Von einer kleineren Lernumgebung mit intensiver Betreuung profitieren</span>
              </li>
              <li class="flex items-start gap-3 text-evolea-text-light">
                <span class="text-evolea-green mt-1">●</span>
                <span>Einen strukturierten, vorhersehbaren Tagesablauf benötigen</span>
              </li>
              <li class="flex items-start gap-3 text-evolea-text-light">
                <span class="text-evolea-green mt-1">●</span>
                <span>In der Regelschule zusätzliche Unterstützung brauchen</span>
              </li>
            </>
          )}
        </ul>

        <h2 class="text-3xl font-display font-bold text-evolea-purple mb-6 flex items-center gap-3">
          <span class="text-evolea-sky">●</span>
          {getText(ansatz.titel, 'Unser Ansatz')}
        </h2>
        <p class="text-evolea-text-light mb-6 text-lg leading-relaxed">
          {getText(ansatz.text, 'Die EVOLEA Tagesschule basiert auf bewährten, evidenzbasierten Methoden und verbindet strukturiertes Lernen mit individueller Förderung.')}
        </p>

        <div class="grid md:grid-cols-2 gap-4 mb-12">
          {ansatz.features?.length > 0 ? (
            ansatz.features.map((feature: any) => (
              <div class="bg-white border border-evolea-purple/10 rounded-evolea p-4">
                <strong class="text-evolea-purple">{getText(feature.titel, '')}</strong>
                <p class="text-sm text-evolea-text-light mb-0">{getText(feature.text, '')}</p>
              </div>
            ))
          ) : (
            <>
              <div class="bg-white border border-evolea-purple/10 rounded-evolea p-4">
                <strong class="text-evolea-purple">Individuelle Lernpläne</strong>
                <p class="text-sm text-evolea-text-light mb-0">Auf jedes Kind abgestimmte Ziele und Aktivitäten</p>
              </div>
              <div class="bg-white border border-evolea-purple/10 rounded-evolea p-4">
                <strong class="text-evolea-purple">Visuelle Strukturen</strong>
                <p class="text-sm text-evolea-text-light mb-0">Klare Ablaufpläne und visuelle Unterstützung</p>
              </div>
              <div class="bg-white border border-evolea-purple/10 rounded-evolea p-4">
                <strong class="text-evolea-purple">Kleine Gruppen</strong>
                <p class="text-sm text-evolea-text-light mb-0">Hoher Betreuungsschlüssel für optimale Förderung</p>
              </div>
              <div class="bg-white border border-evolea-purple/10 rounded-evolea p-4">
                <strong class="text-evolea-purple">Positive Verstärkung</strong>
                <p class="text-sm text-evolea-text-light mb-0">Motivation durch Erfolge und Anerkennung</p>
              </div>
              <div class="bg-white border border-evolea-purple/10 rounded-evolea p-4">
                <strong class="text-evolea-purple">Akademische Förderung</strong>
                <p class="text-sm text-evolea-text-light mb-0">Angepasster Lehrplan für schulische Inhalte</p>
              </div>
              <div class="bg-white border border-evolea-purple/10 rounded-evolea p-4">
                <strong class="text-evolea-purple">Soziale Kompetenz</strong>
                <p class="text-sm text-evolea-text-light mb-0">Gezielte Förderung sozialer Fähigkeiten</p>
              </div>
            </>
          )}
        </div>

        <h2 class="text-3xl font-display font-bold text-evolea-purple mb-6 flex items-center gap-3">
          <span class="text-evolea-coral">●</span>
          {getText(typischerTag.titel, 'Ein typischer Tag')}
        </h2>
        <p class="text-evolea-text-light mb-6 text-lg leading-relaxed">
          {getText(typischerTag.text, 'Unser strukturierter Tagesablauf bietet Sicherheit und Vorhersehbarkeit, während er gleichzeitig Raum für individuelle Bedürfnisse lässt.')}
        </p>

        <div class="bg-evolea-cream rounded-evolea-lg p-8 mb-12">
          <div class="space-y-4">
            {typischerTag.ablauf?.length > 0 ? (
              typischerTag.ablauf.map((eintrag: any, idx: number, arr: any[]) => (
                <div class:list={["flex items-center gap-4", idx < arr.length - 1 ? "pb-4 border-b border-evolea-purple/10" : ""]}>
                  <span class="text-evolea-purple font-mono font-bold w-16">{eintrag.zeit}</span>
                  <span class="text-evolea-text">{getText(eintrag.aktivitaet, '')}</span>
                </div>
              ))
            ) : (
              <>
                <div class="flex items-center gap-4 pb-4 border-b border-evolea-purple/10">
                  <span class="text-evolea-purple font-mono font-bold w-16">08:30</span>
                  <span class="text-evolea-text">Ankommen und Morgenritual</span>
                </div>
                <div class="flex items-center gap-4 pb-4 border-b border-evolea-purple/10">
                  <span class="text-evolea-purple font-mono font-bold w-16">09:00</span>
                  <span class="text-evolea-text">Individuelles Lernen (Block 1)</span>
                </div>
                <div class="flex items-center gap-4 pb-4 border-b border-evolea-purple/10">
                  <span class="text-evolea-purple font-mono font-bold w-16">10:30</span>
                  <span class="text-evolea-text">Pause und Bewegung</span>
                </div>
                <div class="flex items-center gap-4 pb-4 border-b border-evolea-purple/10">
                  <span class="text-evolea-purple font-mono font-bold w-16">11:00</span>
                  <span class="text-evolea-text">Gruppenaktivitäten</span>
                </div>
                <div class="flex items-center gap-4 pb-4 border-b border-evolea-purple/10">
                  <span class="text-evolea-purple font-mono font-bold w-16">12:00</span>
                  <span class="text-evolea-text">Mittagessen und Erholung</span>
                </div>
                <div class="flex items-center gap-4 pb-4 border-b border-evolea-purple/10">
                  <span class="text-evolea-purple font-mono font-bold w-16">13:30</span>
                  <span class="text-evolea-text">Individuelles Lernen (Block 2)</span>
                </div>
                <div class="flex items-center gap-4 pb-4 border-b border-evolea-purple/10">
                  <span class="text-evolea-purple font-mono font-bold w-16">15:00</span>
                  <span class="text-evolea-text">Kreative und praktische Aktivitäten</span>
                </div>
                <div class="flex items-center gap-4">
                  <span class="text-evolea-purple font-mono font-bold w-16">16:00</span>
                  <span class="text-evolea-text">Tagesabschluss und Abholen</span>
                </div>
              </>
            )}
          </div>
        </div>

        <h2 class="text-3xl font-display font-bold text-evolea-purple mb-6 flex items-center gap-3" id="interesse">
          <span class="text-evolea-mint">●</span>
          {getText(interesse.titel, 'Interesse anmelden')}
        </h2>
        <p class="text-evolea-text-light mb-6 text-lg leading-relaxed">
          {getText(interesse.text, 'Die EVOLEA Tagesschule befindet sich derzeit in der Aufbauphase. Wir sammeln Interessensbekundungen von Familien, um das Programm optimal auf die Bedürfnisse der Kinder auszurichten.')}
        </p>

        <div class="bg-evolea-purple/5 rounded-evolea-lg p-8 mb-12">
          <h3 class="font-display font-bold text-evolea-purple text-xl mb-4">{getText(interesse.schritteTitel, 'So geht es weiter')}</h3>
          <div class="space-y-4">
            {interesse.schritte?.length > 0 ? (
              interesse.schritte.map((schritt: any, idx: number) => (
                <div class="flex items-start gap-3">
                  <span class="bg-evolea-purple text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold shrink-0">{idx + 1}</span>
                  <div>
                    <strong class="text-evolea-purple">{getText(schritt.titel, '')}</strong>
                    <p class="text-evolea-text-light mb-0">{getText(schritt.text, '')}</p>
                  </div>
                </div>
              ))
            ) : (
              <>
                <div class="flex items-start gap-3">
                  <span class="bg-evolea-purple text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold shrink-0">1</span>
                  <div>
                    <strong class="text-evolea-purple">Interesse bekunden</strong>
                    <p class="text-evolea-text-light mb-0">Kontaktieren Sie uns per E-Mail oder über unser Kontaktformular.</p>
                  </div>
                </div>
                <div class="flex items-start gap-3">
                  <span class="bg-evolea-purple text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold shrink-0">2</span>
                  <div>
                    <strong class="text-evolea-purple">Unverbindliches Gespräch</strong>
                    <p class="text-evolea-text-light mb-0">Wir laden Sie zu einem Kennenlerngespräch ein, um Ihre Bedürfnisse zu verstehen.</p>
                  </div>
                </div>
                <div class="flex items-start gap-3">
                  <span class="bg-evolea-purple text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold shrink-0">3</span>
                  <div>
                    <strong class="text-evolea-purple">Informiert bleiben</strong>
                    <p class="text-evolea-text-light mb-0">Wir halten Sie über den Aufbau und den geplanten Start auf dem Laufenden.</p>
                  </div>
                </div>
              </>
            )}
          </div>
        </div>

        <div class="bg-evolea-green/10 border-l-4 border-evolea-green rounded-r-evolea p-6 mb-12">
          <h3 class="font-display font-bold text-evolea-purple text-xl mb-2">{getText(interesse.kontaktTitel, 'Kontakt aufnehmen')}</h3>
          <p class="text-evolea-text-light mb-4">
            {getText(interesse.kontaktText, 'Haben Sie Fragen oder möchten Sie Ihr Interesse anmelden? Wir freuen uns auf Ihre Nachricht.')}
          </p>
          <div class="flex flex-wrap gap-4">
            <a href={translatePath('/kontakt/')} class="inline-flex items-center gap-2 text-evolea-purple font-medium hover:underline">
              <Icon name="mail" size="sm" />
              hello@evolea.ch
            </a>
            <a href="https://wa.me/41789591974" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 text-evolea-green font-medium hover:underline">
              <Icon name="heart" size="sm" />
              WhatsApp
            </a>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- Related Programs -->
  <section class="py-16 bg-white">
    <div class="container mx-auto max-w-6xl px-4">
      <h2 class="text-3xl font-display font-bold text-evolea-purple mb-8 text-center">{getText(weitereAngebote.titel, 'Weitere Angebote')}</h2>
      <div class="grid md:grid-cols-3 gap-6">
        {weitereAngebote.angebote?.length > 0 ? (
          weitereAngebote.angebote.map((angebot: any) => (
            <a href={translatePath(angebot.link)} class="group bg-evolea-cream rounded-evolea-lg p-6 hover:shadow-card transition-shadow">
              <div class="flex items-center gap-3 mb-4">
                <Icon name="sprout" size="lg" />
                <h3 class="font-display font-bold text-evolea-purple group-hover:text-evolea-purple-light transition-colors">{angebot.titel}</h3>
              </div>
              <p class="text-sm text-evolea-text-light">{getText(angebot.beschreibung, '')}</p>
            </a>
          ))
        ) : (
          <>
            <a href={translatePath('/angebote/mini-garten/')} class="group bg-evolea-cream rounded-evolea-lg p-6 hover:shadow-card transition-shadow">
              <div class="flex items-center gap-3 mb-4">
                <Icon name="sprout" size="lg" />
                <h3 class="font-display font-bold text-evolea-purple group-hover:text-evolea-purple-light transition-colors">Mini Garten</h3>
              </div>
              <p class="text-sm text-evolea-text-light">Kindergartenvorbereitung für 3-6 Jahre</p>
            </a>
            <a href={translatePath('/angebote/mini-projekte/')} class="group bg-evolea-cream rounded-evolea-lg p-6 hover:shadow-card transition-shadow">
              <div class="flex items-center gap-3 mb-4">
                <Icon name="palette" size="lg" />
                <h3 class="font-display font-bold text-evolea-purple group-hover:text-evolea-purple-light transition-colors">Mini Projekte</h3>
              </div>
              <p class="text-sm text-evolea-text-light">Soziale Kompetenzen für 5-8 Jahre</p>
            </a>
            <a href={translatePath('/angebote/mini-turnen/')} class="group bg-evolea-cream rounded-evolea-lg p-6 hover:shadow-card transition-shadow">
              <div class="flex items-center gap-3 mb-4">
                <Icon name="ball" size="lg" />
                <h3 class="font-display font-bold text-evolea-purple group-hover:text-evolea-purple-light transition-colors">Mini Turnen</h3>
              </div>
              <p class="text-sm text-evolea-text-light">Bewegung und Spass für 5-8 Jahre</p>
            </a>
          </>
        )}
      </div>
    </div>
  </section>

  <!-- CTA Section from CMS -->
  <GradientCTA
    title={getText(cta.titel, 'Fragen zur Tagesschule?')}
    description={getText(cta.beschreibung, 'Kontaktieren Sie uns für ein unverbindliches Gespräch über das Tagesschul-Programm.')}
    buttonText={getText(cta.buttonText, 'Jetzt Kontakt aufnehmen')}
    buttonHref={translatePath('/kontakt/')}
  />
</Base>
