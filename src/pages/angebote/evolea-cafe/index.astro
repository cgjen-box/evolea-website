---
import Base from '@layouts/Base.astro';
import CafePage from '@components/CafePage.astro';
import { getEntry } from 'astro:content';
import { getLangFromUrl, useTranslatedPath } from '@i18n/utils';

const lang = getLangFromUrl(Astro.url);
const translatePath = useTranslatedPath(lang);
const base = import.meta.env.BASE_URL.replace(/\/$/, '');
const cafeEntry = await getEntry('pages', 'evolea-cafe');
const cafe = cafeEntry?.data;

// Hero image
const heroImage = base + '/images/hero/evolea-cafe-hero.png';

const isEnglish = lang === 'en';
const getText = (value: any, fallback = '') => {
  if (!value) return fallback;
  if (typeof value === 'string') return value || fallback;
  const selected = isEnglish ? value.en : value.de;
  return selected || value.de || value.en || fallback;
};

const fallbackTitle = isEnglish
  ? 'EVOLEA Cafe | Parent Community'
  : 'EVOLEA Cafe | Austausch fuer Eltern';
const fallbackDescription = isEnglish
  ? 'Every 2nd Wednesday, parents of children on the spectrum meet for exchange. No registration needed. Just drop by.'
  : 'Jeden 2. Mittwoch treffen sich Eltern von Kindern im Spektrum zum Austausch. Keine Anmeldung noetig. Einfach vorbeikommen.';

const pageTitle = getText(cafe?.seo?.title, fallbackTitle);
const pageDescription = getText(cafe?.seo?.description, fallbackDescription);
---

<Base title={pageTitle} description={pageDescription}>
  <CafePage content={cafe} lang={lang} translatePath={translatePath} heroImage={heroImage} />
</Base>
