---
import FloatingShapes from '@components/FloatingShapes.astro';
import Icon from '@components/Icon.astro';

const { content, lang, heroImage } = Astro.props;

const isEnglish = lang === 'en';

const getText = (value: any, fallback = '') => {
  if (!value) return fallback;
  if (typeof value === 'string') return value || fallback;
  const selected = isEnglish ? value.en : value.de;
  return selected || value.de || value.en || fallback;
};

const getArray = (value: any) => (Array.isArray(value) ? value : []);

const hero = content?.hero || {};
const about = content?.about || {};
const schedule = content?.schedule || {};
const expect = content?.expect || {};
const quote = content?.quote || {};
const faq = content?.faq || {};

const aboutParagraphs = getArray(about.abschnitte);
const aboutCards = getArray(content?.aboutCards);
const scheduleCards = getArray(schedule.cards);
const scheduleDates = getArray(schedule.daten);
const expectItems = getArray(expect.items);
const faqItems = getArray(faq.items);
---

<main class="cafe-page">
  <!-- Hero Section with Prism Gradient and Image -->
  <section class="cafe-hero">
    <FloatingShapes variant="minimal" />
    <div class="cafe-hero-wrapper container">
      <div class="cafe-hero-content">
        <div class="cafe-hero-icon">
          <Icon name="coffee" size="xl" class="icon-white" gradient={false} />
        </div>
        <span class="cafe-hero-badge">{getText(hero.badge)}</span>
        <h1>{getText(hero.titel, 'EVOLEA Cafe')}</h1>
        <p class="cafe-hero-tagline">
          {getText(hero.tagline)}
        </p>
      </div>
      {heroImage && (
        <div class="cafe-hero-image-container">
          <img
            src={heroImage}
            alt={getText(hero.titel, 'EVOLEA Cafe')}
            class="cafe-hero-image"
            loading="eager"
          />
        </div>
      )}
    </div>
  </section>

  <!-- About Section -->
  <section class="cafe-about">
    <div class="container">
      <div class="about-grid">
        <div class="about-text">
          <h2>{getText(about.titel)}</h2>
          {aboutParagraphs.map((paragraph) => (
            <p>{getText(paragraph)}</p>
          ))}
          {about.hinweis && (
            <p class="about-note">{getText(about.hinweis)}</p>
          )}
        </div>
        <div class="about-cards">
          {aboutCards.map((card) => (
            <div class="info-card">
              <Icon name={card.icon || 'sparkle'} size="lg" />
              <span>{getText(card.text)}</span>
            </div>
          ))}
        </div>
      </div>
    </div>
  </section>

  <!-- Schedule Section -->
  <section class="cafe-schedule">
    <div class="container">
      <h2>{getText(schedule.titel)}</h2>

      <div class="schedule-grid">
        {scheduleCards.map((card) => {
          const variant = card.variant || 'standard';
          const className =
            variant === 'primary'
              ? 'schedule-card primary'
              : variant === 'highlight'
                ? 'schedule-card highlight'
                : 'schedule-card';
          const isHighlight = variant === 'highlight';

          return (
            <div class={className}>
              <div class="schedule-icon">
                <Icon
                  name={card.icon || 'calendar'}
                  size="lg"
                  class={isHighlight ? 'icon-white' : ''}
                  gradient={!isHighlight}
                />
              </div>
              <div class="schedule-info">
                <h3>{getText(card.titel)}</h3>
                <p>{getText(card.text)}</p>
              </div>
            </div>
          );
        })}
      </div>

      <div class="next-dates">
        <h3>{getText(schedule.datenTitel)}</h3>
        <ul>
          {scheduleDates.map((item) => (
            <li>
              <span class="date">{getText(item.datum)}</span>
              <span class="time">{getText(item.uhrzeit)}</span>
            </li>
          ))}
        </ul>
      </div>
    </div>
  </section>

  <!-- What to Expect Section -->
  <section class="cafe-expect">
    <div class="container">
      <h2>{getText(expect.titel)}</h2>

      <div class="expect-grid">
        {expectItems.map((item) => {
          const isNo = item.typ === 'no';
          return (
            <div class={`expect-item ${isNo ? 'no' : 'yes'}`}>
              <Icon name={isNo ? 'sparkle' : 'check'} size="sm" />
              <span>{getText(item.text)}</span>
            </div>
          );
        })}
      </div>
    </div>
  </section>

  <!-- Quote Section (Dark Vision Style) -->
  <section class="cafe-quote">
    <blockquote>
      <p>
        {getText(quote.text)}
      </p>
      <cite>{getText(quote.autor)}</cite>
    </blockquote>
  </section>

  <!-- FAQ Section -->
  <section class="cafe-faq">
    <div class="container">
      <h2>{getText(faq.titel)}</h2>

      <div class="faq-grid">
        {faqItems.map((item) => (
          <div class="faq-item">
            <h3>{getText(item.frage)}</h3>
            <p>{getText(item.antwort)}</p>
          </div>
        ))}
      </div>
    </div>
  </section>
</main>

<style>
  /* ===========================================
     EVOLEA CAFE PAGE
     Following Brand Guide v3.0
     =========================================== */

  .cafe-page {
    --evolea-cafe-primary: var(--evolea-magenta);
    --evolea-cafe-accent: var(--evolea-purple);
    --evolea-cafe-mint: var(--evolea-mint);
  }

  .container {
    max-width: 900px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  /* ===========================================
     HERO SECTION - PRISM GRADIENT
     =========================================== */
  .cafe-hero {
    position: relative;
    background: linear-gradient(
      135deg,
      #7BEDD5 0%,
      #A8F0E0 10%,
      #FFE066 25%,
      #FFEEBB 35%,
      #FFD5E5 45%,
      #F5B8D0 55%,
      #E97BF1 70%,
      #CD87F8 85%,
      #B56FE8 100%
    );
    padding: 8rem 1.5rem 6rem;
    overflow: hidden;
  }

  .cafe-hero-wrapper {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    align-items: center;
    position: relative;
    z-index: 10;
  }

  @media (min-width: 1024px) {
    .cafe-hero-wrapper {
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
    }
  }

  .cafe-hero-content {
    position: relative;
    z-index: 10;
    text-align: center;
    order: 2;
  }

  @media (min-width: 1024px) {
    .cafe-hero-content {
      text-align: left;
      order: 1;
    }
  }

  .cafe-hero-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    filter: drop-shadow(0 4px 20px rgba(138, 61, 158, 0.3));
  }

  .cafe-hero-icon :global(.icon-white) {
    color: #FFFFFF;
  }

  .cafe-hero-badge {
    display: inline-block;
    font-family: 'Poppins', sans-serif;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--evolea-purple);
    background: rgba(255, 255, 255, 0.95);
    padding: 0.5rem 1rem;
    border-radius: 9999px;
    margin-bottom: 1.5rem;
    box-shadow: 0 4px 20px rgba(186, 83, 173, 0.3);
  }

  .cafe-hero h1 {
    font-family: 'Fredoka', sans-serif;
    font-size: clamp(2.5rem, 6vw, 3.5rem);
    font-weight: 700;
    color: #FFFFFF;
    margin: 0 0 1rem;
    text-shadow:
      0 2px 4px rgba(0, 0, 0, 0.1),
      0 4px 20px rgba(138, 61, 158, 0.3),
      0 0 60px rgba(186, 83, 173, 0.2);
  }

  .cafe-hero-tagline {
    font-size: 1.25rem;
    color: #FFFFFF;
    line-height: 1.6;
    margin: 0;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .cafe-hero-image-container {
    order: 1;
    display: flex;
    justify-content: center;
  }

  @media (min-width: 1024px) {
    .cafe-hero-image-container {
      order: 2;
    }
  }

  .cafe-hero-image {
    width: 100%;
    max-width: 500px;
    height: auto;
    border-radius: 1.5rem;
    box-shadow:
      0 20px 40px rgba(138, 61, 158, 0.2),
      0 8px 16px rgba(0, 0, 0, 0.1);
    object-fit: cover;
    aspect-ratio: 4/3;
  }

  @media (min-width: 1024px) {
    .cafe-hero-image {
      max-width: 100%;
    }
  }

  /* ===========================================
     ABOUT SECTION
     =========================================== */
  .cafe-about {
    padding: 5rem 0;
    background: white;
  }

  .about-grid {
    display: grid;
    gap: 3rem;
    align-items: center;
  }

  @media (min-width: 768px) {
    .about-grid {
      grid-template-columns: 1.3fr 1fr;
    }
  }

  .about-text h2 {
    font-family: 'Fredoka', sans-serif;
    font-size: clamp(1.75rem, 3vw, 2.25rem);
    font-weight: 700;
    color: var(--evolea-purple);
    margin: 0 0 1.5rem;
  }

  .about-text p {
    font-size: 1.1rem;
    color: var(--evolea-text-light);
    line-height: 1.7;
    margin: 0 0 1rem;
  }

  .about-note {
    font-style: italic;
    color: var(--evolea-magenta) !important;
    font-weight: 500;
  }

  .about-cards {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }

  .info-card {
    background: var(--evolea-cream);
    padding: 1.5rem;
    border-radius: 16px;
    text-align: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 2px solid transparent;
  }

  .info-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(186, 83, 173, 0.15);
    border-color: var(--evolea-purple-light);
  }

  .info-card :global(svg) {
    margin: 0 auto 0.5rem;
    color: var(--evolea-magenta);
  }

  .info-card span:last-child {
    display: block;
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--evolea-text);
  }

  /* ===========================================
     SCHEDULE SECTION
     =========================================== */
  .cafe-schedule {
    padding: 5rem 0;
    background: var(--evolea-cream);
  }

  .cafe-schedule h2 {
    font-family: 'Fredoka', sans-serif;
    font-size: clamp(1.75rem, 3vw, 2.25rem);
    font-weight: 700;
    color: var(--evolea-purple);
    margin: 0 0 2.5rem;
    text-align: center;
  }

  .schedule-grid {
    display: grid;
    gap: 1rem;
    margin-bottom: 2.5rem;
  }

  @media (min-width: 600px) {
    .schedule-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  .schedule-card {
    background: white;
    padding: 1.5rem;
    border-radius: 16px;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: 0 4px 20px rgba(186, 83, 173, 0.08);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .schedule-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(186, 83, 173, 0.15);
  }

  .schedule-card.primary {
    background: linear-gradient(135deg, #BA53AD 0%, #DD48E0 50%, #E97BF1 100%);
  }

  .schedule-card.primary h3,
  .schedule-card.primary p {
    color: white;
  }

  .schedule-card.primary :global(svg) {
    color: white;
  }

  .schedule-card.highlight {
    background: var(--evolea-purple);
  }

  .schedule-card.highlight h3,
  .schedule-card.highlight p {
    color: white;
  }

  .schedule-icon {
    flex-shrink: 0;
  }

  .schedule-icon :global(svg) {
    color: var(--evolea-magenta);
  }

  .schedule-info h3 {
    font-family: 'Fredoka', sans-serif;
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--evolea-text);
    margin: 0 0 0.25rem;
  }

  .schedule-info p {
    font-size: 0.9rem;
    color: var(--evolea-text-light);
    margin: 0;
  }

  .next-dates {
    background: white;
    padding: 1.5rem;
    border-radius: 16px;
    max-width: 400px;
    margin: 0 auto;
    box-shadow: 0 4px 20px rgba(186, 83, 173, 0.08);
  }

  .next-dates h3 {
    font-family: 'Fredoka', sans-serif;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--evolea-purple);
    margin: 0 0 1rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    text-align: center;
  }

  .next-dates ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .next-dates li {
    display: flex;
    justify-content: space-between;
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(186, 83, 173, 0.1);
  }

  .next-dates li:last-child {
    border-bottom: none;
  }

  .next-dates .date {
    font-weight: 500;
    color: var(--evolea-text);
  }

  .next-dates .time {
    color: var(--evolea-text-light);
  }

  /* ===========================================
     EXPECT SECTION
     =========================================== */
  .cafe-expect {
    padding: 5rem 0;
    background: white;
  }

  .cafe-expect h2 {
    font-family: 'Fredoka', sans-serif;
    font-size: clamp(1.75rem, 3vw, 2.25rem);
    font-weight: 700;
    color: var(--evolea-purple);
    margin: 0 0 2.5rem;
    text-align: center;
  }

  .expect-grid {
    display: grid;
    gap: 0.75rem;
  }

  @media (min-width: 600px) {
    .expect-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  .expect-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    border-radius: 12px;
    background: var(--evolea-cream);
    transition: transform 0.2s ease;
  }

  .expect-item:hover {
    transform: translateX(4px);
  }

  .expect-item :global(svg) {
    flex-shrink: 0;
  }

  .expect-item.yes :global(svg) {
    color: var(--evolea-mint);
  }

  .expect-item.no {
    background: transparent;
    opacity: 0.65;
  }

  .expect-item.no :global(svg) {
    color: var(--evolea-text-light);
  }

  .expect-item span {
    font-size: 0.95rem;
    color: var(--evolea-text);
  }

  /* ===========================================
     QUOTE SECTION - DARK VISION STYLE
     =========================================== */
  .cafe-quote {
    padding: 5rem 1.5rem;
    background: linear-gradient(180deg, #1A1A2E 0%, #2D2A32 100%);
    position: relative;
    overflow: hidden;
  }

  .cafe-quote blockquote {
    max-width: 700px;
    margin: 0 auto;
    text-align: center;
    position: relative;
    z-index: 10;
  }

  .cafe-quote p {
    font-family: 'Fredoka', sans-serif;
    font-size: clamp(1.25rem, 3vw, 1.6rem);
    font-weight: 600;
    background: linear-gradient(90deg, #7BEDD5, #FFE066, #FF9ECC, #E97BF1, #CD87F8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1.5;
    margin: 0 0 1.5rem;
  }

  .cafe-quote cite {
    font-family: 'Poppins', sans-serif;
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.7);
    font-style: normal;
  }

  /* ===========================================
     FAQ SECTION
     =========================================== */
  .cafe-faq {
    padding: 5rem 0;
    background: var(--evolea-cream);
  }

  .cafe-faq h2 {
    font-family: 'Fredoka', sans-serif;
    font-size: clamp(1.75rem, 3vw, 2.25rem);
    font-weight: 700;
    color: var(--evolea-purple);
    margin: 0 0 2.5rem;
    text-align: center;
  }

  .faq-grid {
    display: grid;
    gap: 1.25rem;
  }

  @media (min-width: 600px) {
    .faq-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  .faq-item {
    padding: 1.5rem;
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(186, 83, 173, 0.08);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .faq-item:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(186, 83, 173, 0.15);
  }

  .faq-item h3 {
    font-family: 'Fredoka', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    color: var(--evolea-purple);
    margin: 0 0 0.5rem;
  }

  .faq-item p {
    font-size: 0.95rem;
    color: var(--evolea-text-light);
    line-height: 1.6;
    margin: 0;
  }

  /* Reduce motion for accessibility */
  @media (prefers-reduced-motion: reduce) {
    .info-card,
    .schedule-card,
    .expect-item,
    .faq-item {
      transition: none;
    }

    .info-card:hover,
    .schedule-card:hover,
    .expect-item:hover,
    .faq-item:hover {
      transform: none;
    }
  }
</style>
